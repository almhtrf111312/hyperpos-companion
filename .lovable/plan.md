

## هيكلة وضع الأفران والمخابز - النسخة النهائية الشاملة

### ملخص التغييرات

تطبيق هيكلة شاملة لوضع المخابز تشمل: تبسيط نموذج المنتج، إضافة صفحة مشتريات مستقلة، تعديل الشريط الجانبي، تحديث عرض المنتجات، وتحديث التصنيفات والتقارير.

---

### 1. تبسيط نموذج إضافة/تعديل المنتج (وضع المخبز)

**الحقول المعروضة فقط:**
- اسم الصنف + التصنيف
- سعر البيع + سعر الجملة
- صورة المنتج (اختيارية)

**الحقول المخفية في وضع المخبز:**
- الباركود (كل حقول الباركود 1/2/3 + زر القارئ) - يُولّد تلقائياً كـ timestamp
- الكمية (تُعيّن تلقائياً 99999)
- سعر الشراء (لا يوجد رأسمال)
- المتغير/الوصف
- إعدادات الوحدات المزدوجة (كرتونة/قطعة)
- تاريخ الصلاحية، الرقم التسلسلي، الضمان، رقم التشغيلة
- الحد الأدنى للمخزون

**التحقق:** في وضع المخبز، لا يُطلب الباركود (يُولّد تلقائياً)

### 2. تعديل عرض قائمة المنتجات (وضع المخبز)

**الأعمدة المعروضة فقط:**
- اسم الصنف + الصورة
- التصنيف
- سعر البيع
- سعر الجملة

**الأعمدة المخفية:**
- سعر الشراء والربح (لا رأسمال)
- المخزون والحالة
- العهدة
- الباركود

### 3. إضافة صفحة المشتريات المستقلة

**ملف جديد:** `src/pages/Purchases.tsx`
- صفحة مخصصة لتسجيل المواد الخام (طحين، سكر، فانيلا، شوكولا، زبدة، بيض، حليب)
- تستخدم نظام فواتير الشراء الموجود (PurchaseInvoiceDialog + جداول purchase_invoices)
- تعرض قائمة بفواتير الشراء السابقة مع إمكانية إضافة فاتورة جديدة
- تظهر فقط في وضع المخبز

### 4. تحديث الشريط الجانبي

- إضافة عنصر "المشتريات" بأيقونة Truck بعد "المنتجات" مباشرة
- يظهر فقط في وضع المخبز (bakery)
- إخفاء زر فاتورة الشراء من صفحة المنتجات في وضع المخبز (لأنه انتقل لصفحة مستقلة)

### 5. تحديث التوجيه (App.tsx)

- إضافة مسار `/purchases` محمي بـ ProtectedRoute و RoleGuard

### 6. تحديث التصنيفات الافتراضية

- تصنيفات المنتجات (أصناف البيع): جاتو، بانكيك، بيتي فور، شعبيات، كعك، خبز، معجنات
- تصنيفات المشتريات: طحين، سكر، فانيلا، شوكولا، زبدة، بيض، حليب

### 7. تحديث إعدادات الحقول الديناميكية

تعطيل جميع الحقول الإضافية في وضع المخبز:
- expiryDate: false
- serialNumber: false
- warranty: false
- batchNumber: false
- minStockLevel: false
- sizeColor: false
- wholesalePrice: true (الوحيد المفعّل)

### 8. تحديث الأقسام المرئية

- maintenance: false (لا صيانة في المخبز)
- expiry: false
- serialNumber: false
- warranty: false
- sizeColor: false

### 9. إضافة الترجمات

- nav.purchases (المشتريات / Purchases / Satin Almalar)
- purchases.title / purchases.subtitle / purchases.addNew

---

### التفاصيل التقنية

**الملفات المعدلة:**
1. `src/pages/Products.tsx` - إحاطة حقول الباركود وسعر الشراء والمتغير وإعدادات الوحدات بشرط `{!noInventory && (...)}` - تعديل handleAddProduct لتوليد باركود تلقائي وتعيين costPrice=0 في وضع المخبز - إخفاء زر فاتورة الشراء في وضع المخبز - تعديل عرض الجدول والبطاقات لإخفاء الأعمدة غير المطلوبة
2. `src/components/layout/Sidebar.tsx` - إضافة عنصر المشتريات (bakery only)
3. `src/App.tsx` - إضافة مسار /purchases
4. `src/lib/store-type-config.ts` - تحديث getVisibleSections وgetDefaultCategories للمخبز
5. `src/lib/product-fields-config.ts` - تحديث إعدادات المخبز الافتراضية
6. `src/lib/i18n.ts` - إضافة ترجمات المشتريات

**الملفات الجديدة:**
1. `src/pages/Purchases.tsx` - صفحة المشتريات المستقلة

**لا توجد تغييرات في قاعدة البيانات** - صفحة المشتريات تستخدم جداول purchase_invoices و purchase_invoice_items الموجودة.

