

## خطة: تحسين شروط عرض الجولة التعليمية + توحيد واجهة العملاء والديون

### التغيير الأول: شروط عرض الجولة التعليمية

**المشكلة الحالية:** الجولة تظهر لأي مستخدم لم يُكملها بناءً على `localStorage` فقط.

**الحل:** تعديل `OnboardingTour.tsx` ليتحقق من:
- أول فتح للتطبيق بعد إنشاء الحساب (تاريخ إنشاء الحساب قريب)
- المفتاح `hp_onboarding_complete` غير موجود في `localStorage`
- الدور: كاشير (`cashier`)، مالك (`boss`)، مدير (`admin`) -- جميع الأدوار المدعومة

**التنفيذ:** إضافة استيراد `useUserRole` و`useAuth` للتحقق من أن المستخدم مسجل دخوله وله دور صالح قبل بدء الجولة.

---

### التغيير الثاني: توحيد واجهة العملاء والديون

**المشكلة الحالية:**
- صفحة العملاء: العنوان + زر "إضافة عميل" في الأعلى، ثم التبويبات أسفل العنوان
- صفحة الديون (المدمجة): تعرض عنوانها الخاص "الديون" مع زر "إضافة دين نقدي" بشكل مستقل
- النتيجة: عند التبديل بين التبويبين، يتغير شكل الصفحة بالكامل (عنوان مختلف، مكان زر مختلف)

**الحل:** توحيد الهيكل بحيث:
- العنوان "العملاء والديون" ثابت دائماً في الأعلى
- التبويبات (العملاء | الديون) تحت العنوان مباشرة
- زر الإضافة يتغير حسب التبويب النشط:
  - تبويب العملاء: "إضافة عميل"
  - تبويب الديون: "إضافة دين نقدي"
- إزالة العنوان والهيدر المكرر من مكون `Debts` عند عرضه داخل تبويب العملاء

**التنفيذ:**

1. تعديل `src/pages/Customers.tsx`:
   - نقل التبويبات لتكون مباشرة تحت العنوان الرئيسي
   - جعل زر الإضافة يتغير ديناميكياً حسب التبويب النشط
   - عندما يكون التبويب "ديون": الزر يفتح نافذة إضافة دين نقدي

2. تعديل `src/pages/Debts.tsx`:
   - إضافة prop اختياري `embedded?: boolean` للمكون
   - عندما يكون `embedded = true`: إخفاء الهيدر (العنوان + زر الإضافة + الوصف) لأنها ستكون موجودة في الصفحة الأم
   - إضافة `onAddDebt` callback prop لفتح نافذة الإضافة من الزر في الهيدر المشترك

3. تعديل `src/components/onboarding/OnboardingTour.tsx`:
   - إضافة فحص الدور والمصادقة

---

### التفاصيل التقنية

**هيكل الصفحة الموحد:**

```text
+------------------------------------------+
| العملاء والديون          [+ إضافة عميل]  |  <-- العنوان + الزر (يتغير نص الزر)
| وصف الصفحة                               |
+------------------------------------------+
| [العملاء]  [الديون]                      |  <-- تبويبات بنفس الحجم
+------------------------------------------+
| الإحصائيات (stats cards)                  |
| البحث                                    |
| القائمة/الشبكة                           |
+------------------------------------------+
```

**تغييرات Debts.tsx:**

```text
// إضافة props جديدة
interface DebtsProps {
  embedded?: boolean;
  onAddDebt?: () => void;
}

// عند embedded = true:
// - إخفاء div الهيدر (العنوان + الزر + الوصف)
// - الإحصائيات + البحث + القائمة تبقى كما هي
```

**تغييرات OnboardingTour.tsx:**

```text
// إضافة فحص:
const { user } = useAuth();
const { role } = useUserRole();

// الجولة تظهر فقط عندما:
// 1. المستخدم مسجل دخول (user !== null)
// 2. له دور صالح (role !== null)
// 3. لم يكمل الجولة سابقاً (localStorage check)
```

**الملفات المعدلة (3 ملفات):**

| الملف | النوع |
|-------|-------|
| `src/pages/Customers.tsx` | تعديل -- توحيد الهيدر والتبويبات |
| `src/pages/Debts.tsx` | تعديل -- إضافة embedded mode |
| `src/components/onboarding/OnboardingTour.tsx` | تعديل -- شروط العرض |

