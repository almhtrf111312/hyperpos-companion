

# خطة التطوير - المراحل المتبقية من خارطة الطريق

بعد مراجعة الكود الحالي، تم تحديد ما هو **منجز بالفعل** وما يحتاج للتنفيذ:

## ما تم إنجازه سابقا (سيتم تخطيه)
- معالجة الأرقام العربية (Locale fix + CSS + utils.ts)
- نظام تعدد الباركود (barcode2, barcode3 + VariantPickerDialog)
- نظام التعليمات الذكية (Help page + AI Assistant)
- نظام تعدد العملات (موجود بالفعل في الفواتير)
- تخصيص نوع النشاط التجاري (store-type-config.ts + product-fields-config.ts)

---

## المرحلة 1: تحسين حقول الإدخال الرقمية

**الهدف**: إضافة `inputMode="decimal"` و `pattern` لجميع حقول الإدخال الرقمية لفرض لوحة مفاتيح الأرقام الإنجليزية على أندرويد.

**الملفات المتأثرة:**
- `src/components/ui/input.tsx` - إضافة منطق تلقائي عند `type="number"` لإضافة `inputMode` و تحويل الأرقام العربية عند الإدخال

---

## المرحلة 2: إضافة نشاط "الفرن والمخبز" (Bakery)

**الهدف**: إضافة نوع نشاط جديد `bakery` لنظام التخصيص الديناميكي.

**الملفات المتأثرة:**
1. `src/lib/product-fields-config.ts` - إضافة `'bakery'` للـ StoreType وتعريف الحقول الافتراضية
2. `src/lib/store-type-config.ts` - إضافة مصطلحات المخبز (AR/EN) + التصنيفات الافتراضية + الأقسام المرئية
3. `src/components/setup/SetupWizard.tsx` - إضافة خيار المخبز في معالج الإعداد (إن لم يكن موجودا)

---

## المرحلة 3: تحسين واجهة البيع (المبلغ المقبوض والباقي)

**الهدف**: إضافة حقل "المبلغ المدفوع" وعرض "المبلغ المتبقي (الباقي)" تلقائيا في شاشة البيع النقدي.

**الملفات المتأثرة:**
- `src/components/pos/CartPanel.tsx` - إضافة حقل إدخال للمبلغ المقبوض مع حساب الباقي تلقائيا وعرضه

---

## المرحلة 4: نظام صلاحيات إخفاء البيانات الحساسة

**الهدف**: إضافة إعداد يسمح للمالك بإخفاء "سعر التكلفة" و"الأرباح" عن الكاشير.

**الملفات المتأثرة:**
1. `src/lib/cloud/index.ts` أو ملف إعدادات جديد - إضافة دالة لجلب إعدادات الصلاحيات من جدول `stores` (حقل JSONB جديد `permissions_settings`)
2. `src/pages/Products.tsx` - إخفاء عمود سعر التكلفة للكاشير
3. `src/pages/Reports.tsx` - إخفاء تقارير الأرباح للكاشير
4. `src/components/pos/CartPanel.tsx` - إخفاء الربح من ملخص الفاتورة للكاشير
5. `src/pages/Settings.tsx` - إضافة قسم إعدادات الصلاحيات للمالك

**ملاحظة:** لا حاجة لجدول جديد في قاعدة البيانات. يمكن استخدام حقل JSONB في جدول `stores` الموجود أصلا (مثل `permissions_settings` أو ضمن `sync_settings`).

---

## ترتيب التنفيذ المقترح

| المرحلة | الوصف | التعقيد |
|---------|-------|---------|
| 1 | تحسين حقول الإدخال الرقمية | منخفض |
| 2 | إضافة نشاط المخبز | منخفض |
| 3 | المبلغ المقبوض والباقي في POS | متوسط |
| 4 | صلاحيات إخفاء البيانات الحساسة | متوسط |

---

## ملاحظات

- **جدول الباركودات الديناميكي** (`product_barcodes`): النظام الحالي بـ 3 أعمدة ثابتة يعمل بكفاءة ولا يحتاج لتغيير حاليا. التحول لجدول منفصل يتطلب تعديلات واسعة في كل مكان يتعامل مع المنتجات. يمكن إعادة النظر لاحقا إذا احتاج المستخدم لأكثر من 3 باركودات.
- **إعادة هيكلة Products.tsx**: ملف كبير (2067 سطر) ويستفيد من التقسيم، لكنه تغيير هيكلي بحت لا يضيف ميزات جديدة. يمكن تنفيذه كمرحلة مستقلة لاحقا.
- **Framer Motion**: إضافة مكتبة جديدة للحركات. يمكن تنفيذها كمرحلة تجميلية مستقلة.

سأبدأ بتنفيذ المرحلة 1 و 2 معا (كونهما بسيطتين)، ثم أنتقل للمرحلة 3 ثم 4.

