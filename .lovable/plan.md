

## خطة: إضافة وضع ورشة الصيانة (Workshop Mode)

### نظرة عامة
تحويل وضع "repair" الحالي إلى وضع ورشة صيانة مبسّط يركز على تكاليف القطع والعمالة بدون تعقيد المخزون، مشابه لوضع المخبز (bakery) من حيث عدم تتبع المخزون.

---

### التغييرات المطلوبة

#### 1. إضافة عمود `labor_cost` لجدول المنتجات (Database Migration)
- إضافة عمود `labor_cost numeric DEFAULT 0` لجدول `products`
- هذا العمود يخزن تكلفة العمالة/ساعة العمل لكل عنصر

#### 2. تعديل `store-type-config.ts`
- جعل وضع `repair` يعمل بدون مخزون (مثل bakery) عبر تعديل `isNoInventoryMode`
- تحديث المصطلحات:
  - product -> عنصر
  - products -> العناصر
  - addProduct -> إضافة عنصر
  - category -> التصنيف (كهرباء، ميكانيكا، إلكترونيات، أدوات)
  - productSearch -> بحث عن عنصر...
- تحديث التصنيفات الافتراضية: كهرباء، ميكانيكا، إلكترونيات، أدوات، قطع غيار عامة

#### 3. تعديل `product-fields-config.ts`
- تحديث حقول وضع repair:
  - تعطيل: serialNumber, warranty, minStockLevel, barcode
  - الإبقاء على: image فقط كحقل إضافي

#### 4. تعديل نموذج المنتج في `Products.tsx`
- في وضع repair:
  - إظهار الحقول فقط: اسم العنصر، التصنيف، تكلفة القطعة (costPrice)، تكلفة العمالة (labor_cost)، الصورة
  - إخفاء: الباركود، الكمية، سعر البيع المعقد، الحقول الديناميكية
  - إخفاء أعمدة الجدول غير الضرورية (الكمية، الحالة، الباركود)

#### 5. تعديل نقطة البيع `CartPanel.tsx`
- في وضع repair:
  - عند إضافة عنصر للسلة، إظهار حقل "المبلغ الفعلي" لإدخال سعر الصيانة يدويا
  - عرض تكلفة القطعة + تكلفة العمالة كمرجع
  - وحدات العرض: قطعة، ساعة، خدمة

#### 6. تعديل القائمة الجانبية `Sidebar.tsx`
- في وضع repair: إخفاء المستودعات ونقل المخزون (مثل bakery)
- إظهار: المشتريات (purchases) في وضع repair أيضا

#### 7. تعديل التقارير `Reports.tsx`
- في وضع repair:
  - إخفاء: تقرير المخزون، تقرير جرد العهدة
  - إظهار: تقارير المبيعات، المصروفات، الديون، الكاشير، الإقفال اليومي
  - إظهار تقرير المشتريات

#### 8. تعديل لوحة التحكم `Dashboard.tsx`
- في وضع repair: إخفاء قيمة المخزون وتنبيهات المخزون المنخفض

---

### التفاصيل التقنية

#### الملفات المعدلة

| الملف | التغيير |
|-------|---------|
| **Database** | إضافة عمود `labor_cost` لجدول products |
| `src/lib/store-type-config.ts` | تعديل `isNoInventoryMode` ليشمل repair + تحديث المصطلحات والتصنيفات |
| `src/lib/product-fields-config.ts` | تبسيط حقول repair |
| `src/pages/Products.tsx` | إخفاء حقول غير ضرورية + إظهار حقل تكلفة العمالة في وضع repair |
| `src/components/pos/CartPanel.tsx` | إضافة إمكانية إدخال المبلغ يدويا في وضع repair |
| `src/components/layout/Sidebar.tsx` | تعديل شروط إظهار القائمة لوضع repair |
| `src/pages/Reports.tsx` | تصفية التقارير المتاحة في وضع repair |
| `src/pages/Dashboard.tsx` | إخفاء إحصائيات المخزون في وضع repair |
| `src/lib/cloud/products-cloud.ts` | إضافة `labor_cost` للنوع Product |
| `src/types/index.ts` | تحديث نوع StoreType |

#### تعديل isNoInventoryMode

```text
الحالي: return type === 'bakery'
الجديد: return type === 'bakery' || type === 'repair'
```

#### نموذج المنتج في وضع repair

```text
الحقول المعروضة:
1. اسم العنصر (name) - إلزامي
2. التصنيف (category) - اختياري
3. تكلفة القطعة (costPrice) - رقمي
4. تكلفة العمالة (labor_cost) - رقمي [جديد]
5. الصورة (image) - اختياري

الحقول المخفية:
- الباركود، الكمية، سعر البيع، الوحدات، جميع الحقول الديناميكية
```

#### سلوك الكاشير في وضع repair

```text
1. المستخدم يختار عنصر من القائمة
2. يظهر حقل "مبلغ الصيانة" لإدخال السعر الفعلي يدويا
3. يعرض كمرجع: تكلفة القطعة + تكلفة العمالة = المجموع التقديري
4. الربح = مبلغ الصيانة - تكلفة القطعة
5. لا يتم خصم من المخزون (مثل bakery)
```

#### مثال عملي

```text
عنصر: إنفرتر
تكلفة القطعة: 1500 ليرة (مخزنة في النظام)
تكلفة العمالة: 500 ليرة (مخزنة في النظام)
المرجع: 2000 ليرة

الكاشير يدخل المبلغ الفعلي: 2500 ليرة
الربح = 2500 - 1500 = 1000 ليرة
```

---

### ملاحظة مهمة
هذه الخطة تعتمد على البنية الحالية لوضع bakery (بدون مخزون) وتوسعها لتشمل وضع repair مع إضافة حقل تكلفة العمالة. التغييرات متوافقة مع النظام الحالي ولن تؤثر على أوضاع المتاجر الأخرى.

