
# إصلاح زر إعادة تعيين الجهاز (Reset Device) في لوحة البوس + إصلاح مشكلة نقل الترخيص

## المشكلة الأولى: زر Reset Device مفقود

في لوحة البوس، زر "إعادة تعيين الجهاز" مخفي لأنه مشروط بوجود `device_id`:

```text
{owner.device_id && !owner.allow_multi_device && (
  <DropdownMenuItem ...>إعادة تعيين الجهاز</DropdownMenuItem>
)}
```

عندما يقوم المستخدم بنقل الترخيص، يتم مسح `device_id` فيصبح `null`، وبالتالي يختفي الزر تماما. الحل: إزالة شرط `owner.device_id` وإبقاء الزر ظاهرا دائما (مع إبقاء شرط `!owner.allow_multi_device` فقط).

## المشكلة الثانية: ظهور شاشة التفعيل بعد نقل الترخيص

بعد نقل الترخيص وتسجيل الدخول على جهاز جديد، تظهر شاشة التفعيل بدلا من الدخول مباشرة. السبب هو أن الكاش المحلي (`hyperpos_license_cache`) يحتفظ ببيانات قديمة من الجلسة السابقة تقول إن الترخيص غير صالح. عند فتح التطبيق على الجهاز الجديد (أو بعد إعادة تسجيل الدخول)، يجب مسح كاش الترخيص القديم لضمان فحص جديد من السيرفر.

بالإضافة لذلك، يجب التأكد أن كاش ربط الجهاز (`hyperpos_device_binding_cache_v1`) يتم مسحه عند تسجيل الخروج (وهو يحدث بالفعل عبر مسح جميع مفاتيح `hyperpos_`).

## التغييرات المطلوبة

### الملف: `src/pages/BossPanel.tsx`
- السطر 1279: إزالة شرط `owner.device_id &&` من شرط عرض زر "إعادة تعيين الجهاز"
- يصبح الشرط فقط `!owner.allow_multi_device` حتى يكون الزر متاحا دائما

### الملف: `src/hooks/use-device-binding.tsx`
- في دالة `checkDeviceBinding`: بعد مسح `device_id` بنجاح في السيرفر (عبر نقل الترخيص)، يجب أن يتم تسجيل الجهاز الجديد تلقائيا بدلا من إظهار حالة "محظور"
- إضافة مسح كاش ربط الجهاز عند تسجيل الخروج (إذا لم يكن مشمولا بالفعل)

### الملف: `src/hooks/use-license.tsx`
- التأكد من أن كاش الترخيص يتم مسحه عند تغيير المستخدم، لضمان فحص جديد من السيرفر عند تسجيل الدخول بحساب مختلف أو من جهاز جديد
