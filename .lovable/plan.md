

# إصلاح مشكلة تسرب البيانات بين الحسابات عند تسجيل الدخول

## المشكلة
عند تسجيل الدخول بحساب مختلف، تظهر منتجات وبيانات الحساب السابق لأن:
1. دالة `signIn` لا تمسح أي بيانات محلية قبل تسجيل الدخول الجديد
2. IndexedDB (كاش المنتجات) لا يُمسح أبداً عند تغيير الحساب
3. كاش الـ cloud stores (في الذاكرة) لا يُبطل عند تسجيل الدخول

## الحل - 3 تعديلات

### 1. مسح البيانات عند تسجيل الدخول (`src/hooks/use-auth.tsx`)
في دالة `signIn`، بعد نجاح تسجيل الدخول وقبل إرجاع النتيجة:
- مسح جميع مفاتيح `hyperpos_*` من localStorage (ما عدا اللغة والثيم)
- مسح IndexedDB بالكامل عبر `clearProductsIDB()`
- إبطال كاش الـ cloud stores عبر `invalidateAllCaches()`

### 2. مسح IndexedDB عند تغيير المستخدم (`src/providers/CloudSyncProvider.tsx`)
في الكود الذي يكتشف تغيير المستخدم (سطر 92):
- إضافة استدعاء `clearProductsIDB()` بجانب مسح localStorage الموجود حالياً

### 3. مسح IndexedDB عند تسجيل الخروج (`src/hooks/use-auth.tsx`)
في دالة `signOut`:
- إضافة استدعاء `clearProductsIDB()` لضمان عدم بقاء بيانات مخزنة

## الملفات المعدّلة
1. **`src/hooks/use-auth.tsx`** - إضافة مسح شامل في `signIn` و `signOut`
2. **`src/providers/CloudSyncProvider.tsx`** - إضافة مسح IndexedDB عند تغيير المستخدم

## النتيجة
- عند تسجيل الدخول بأي حساب: لا تظهر أي بيانات من حساب سابق
- المسح يشمل: localStorage + IndexedDB + كاش الذاكرة
- البيانات تُجلب طازجة من السحابة فقط

