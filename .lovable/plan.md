

# تحسين إدارة الورديات: أزرار التعديل وسجل مفصل

## المشكلة
1. عند إغلاق الوردية بفائض أو عجز، لا توجد طريقة لتعديل الفارق (إضافة مصروف أو إيراد) قبل الإغلاق
2. سجل الورديات لا يعرض تفاصيل كافية عن كل وردية (التعديلات التي تمت)

## الحل

### 1. أزرار تعديل سريع عند وجود فارق (في حوار إغلاق الوردية)

عند إدخال الرصيد الفعلي وظهور فارق، ستظهر أزرار:
- **تسجيل كمصروف**: إذا كان هناك عجز (المبلغ الفعلي أقل من المتوقع) - يسجل الفارق كمصروف في النظام
- **تسجيل كإيراد إضافي**: إذا كان هناك فائض - يسجل الفارق كإيداع

هذه الأزرار تعدّل بيانات الوردية الحالية (salesTotal أو expensesTotal) بحيث يصبح الرصيد المتوقع مطابقاً للرصيد الفعلي، ثم يمكن إغلاق الوردية بدون فارق.

بالإضافة لذلك، سيتم حفظ سجل التعديلات في حقل جديد `adjustments` على الوردية لعرضه لاحقاً في السجل.

### 2. سجل ورديات مفصل

تحسين عرض كل وردية في السجل (History Dialog في Cashbox.tsx) ليشمل:
- رصيد الافتتاح والإغلاق
- المبيعات والمصاريف والإيداعات والسحوبات
- الرصيد المتوقع مقابل الفعلي
- الفارق (فائض/عجز)
- التعديلات التي تمت (إن وجدت) مع نوعها ومبلغها

---

## التفاصيل التقنية

### الملفات المتأثرة

**`src/lib/cashbox-store.ts`**:
- إضافة حقل `adjustments: ShiftAdjustment[]` إلى واجهة `Shift` (مصفوفة بدل عنصر واحد) لتتبع جميع التعديلات
- إضافة دالة `addShiftAdjustment(shiftId, type, amount, reason)` لتسجيل تعديل على الوردية النشطة وتعديل المجاميع وفقاً لذلك
- واجهة `ShiftAdjustment` تحتوي: `id`, `type` (expense_added | income_added), `amount`, `reason`, `createdAt`

**`src/pages/Cashbox.tsx`** (الصفحة الرئيسية - حوار الإغلاق):
- في حوار إغلاق الوردية: عند ظهور فارق، إضافة أزرار "تسجيل كمصروف" (للعجز) و"تسجيل كإيراد" (للفائض)
- عند الضغط على الزر، يتم استدعاء `addShiftAdjustment` ثم إعادة تحميل البيانات فيتحدث الرصيد المتوقع
- تحسين حوار السجل (History Dialog) لعرض تفاصيل كاملة لكل وردية مع التعديلات

**`src/pages/CashShifts.tsx`** (صفحة الورديات الثانية):
- نفس التحسينات: أزرار تعديل في حوار الإغلاق
- إضافة عمود "التعديلات" في جدول الورديات الأخيرة

### تدفق العمل:

```text
1. المستخدم يفتح وردية بمبلغ 100$
2. تتم عمليات بيع ومصاريف خلال اليوم
3. المستخدم يضغط "إغلاق الوردية"
4. يدخل الرصيد الفعلي (مثلاً 180$) والمتوقع 200$ = عجز 20$
5. يظهر زر "تسجيل 20$ كمصروف" 
6. عند الضغط: يُضاف 20$ للمصاريف، الرصيد المتوقع يصبح 180$
7. الآن يمكن إغلاق الوردية بدون فارق
8. في السجل: تظهر الوردية مع ملاحظة "تم تسجيل 20$ كمصروف - عجز في الصندوق"
```

