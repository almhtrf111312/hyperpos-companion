
# خطة إصلاح مشاكل الترجمة والتصميم وتجربة المستخدم

## المشاكل المكتشفة

### 1. نصوص عربية غير مترجمة عند تبديل اللغة للإنجليزية
الملفات التالية تحتوي على نصوص عربية مكتوبة مباشرة (hardcoded) بدلا من استخدام نظام الترجمة `t()`:

| الملف | النصوص غير المترجمة |
|:---|:---|
| `ProductDetailsDialog.tsx` | "سعر الجملة"، "كرتونة"، "قطعة"، "هامش الربح" |
| `ProductGrid.tsx` | عناوين أزرار العرض: "بطاقات"، "أسطر"، "بدون صور" |
| `Products.tsx` | "سعر الجملة ($)" (سطر 1355 و 1701) |
| `PurchaseInvoiceItemForm.tsx` | "سعر الجملة" |
| `ProfitTrendChart.tsx` | "متوسط الربح اليومي"، "هامش الربح" |
| `CashShifts.tsx` | الصفحة بالكامل تقريبا (العنوان، الأزرار، الجداول، رسائل التأكيد) - لا تستخدم `t()` |

### 2. زر القائمة في POS يحجب الإشعارات (LTR)
- في `POSHeader.tsx` زر القائمة (Menu) موجود على اليسار في وضع LTR وهذا صحيح
- لكن في `MainLayout.tsx` زر `MobileMenuTrigger` موضعه `left-4` في LTR وهو يتداخل مع عناصر الإشعارات

### 3. زر القائمة في POS على اليمين في الإنجليزية
- في `POS.tsx` السطر 513: القائمة الجانبية تستخدم `document.documentElement.dir` للتحديد ولكن الهامش يكون فقط على الجانب الصحيح
- المشكلة أن `POSHeader` لا يأخذ بالاعتبار اتجاه RTL/LTR بشكل كامل

### 4. تفاصيل المنتج تفتح عند التمرير (Scroll)
- في `ProductGrid.tsx` مدة الضغط الطويل 500ms فقط وهي قصيرة جدا
- عند التمرير يُفتح حوار التفاصيل بالخطأ لأن `touchStart` يبدأ المؤقت ولا يتم إلغاؤه عند الحركة (`touchMove`)
- **الحل**: إضافة مستمع `onTouchMove` لإلغاء المؤقت + زيادة المدة إلى 1000ms

### 5. تصميم ProductDetailsDialog سيء ومقصوص
- الحوار يستخدم `max-w-xs` وهو ضيق جدا
- الارتفاع `max-h-[60vh]` قد يقص المحتوى
- **الحل**: تحسين الأبعاد والتخطيط ليكون مناسبا للهاتف

### 6. انتقالات غير متسقة عند تبديل الصفحات
- بعض الصفحات تختفي فيها القائمة بشكل سيء وأخرى تعمل بشكل جيد
- السبب: التأخير 100ms في `Sidebar.tsx` سطر 88 ليس كافيا ولا متسقا
- **الحل**: توحيد سلوك الانتقالات

---

## التفاصيل التقنية

### 1. إضافة مفاتيح ترجمة جديدة في `i18n.ts`
إضافة المفاتيح التالية للغتين:

```text
'pos.viewGrid' -> ar: 'بطاقات' / en: 'Grid'
'pos.viewList' -> ar: 'أسطر' / en: 'List'
'pos.viewCompact' -> ar: 'بدون صور' / en: 'Compact'
'products.wholesalePriceLabel' -> ar: 'سعر الجملة' / en: 'Wholesale Price'
'products.profitMargin' -> ar: 'هامش الربح' / en: 'Profit Margin'
'products.avgDailyProfit' -> ar: 'متوسط الربح اليومي' / en: 'Avg Daily Profit'
'products.bulkPrice' -> ar: 'سعر الجملة' / en: 'Bulk Price'
```

### 2. إصلاح ProductGrid - منع فتح التفاصيل أثناء التمرير
- إضافة `onTouchMove` لإلغاء مؤقت الضغط الطويل
- زيادة مدة الضغط من 500ms إلى 1000ms
- إضافة متغير `touchMoved` لمنع الفتح إذا تحرك الإصبع

### 3. تحسين ProductDetailsDialog
- زيادة العرض الأقصى
- تحسين ارتفاع المحتوى
- استبدال النصوص العربية المباشرة بمفاتيح ترجمة

### 4. إصلاح اتجاه القائمة في POS للإنجليزية
- تعديل `POSHeader.tsx` لعكس ترتيب العناصر حسب اتجاه اللغة
- ضمان أن زر القائمة لا يحجب الإشعارات

### 5. توحيد انتقالات القائمة الجانبية
- تحسين التأخير في `Sidebar.tsx` لضمان إغلاق سلس ومتسق على جميع الصفحات

### 6. ترجمة CashShifts.tsx
- استبدال جميع النصوص العربية المباشرة بمفاتيح الترجمة الموجودة فعلا في `i18n.ts`

---

## الملفات المتأثرة

| الملف | التغيير |
|:---|:---|
| `src/lib/i18n.ts` | إضافة مفاتيح ترجمة جديدة |
| `src/components/pos/ProductGrid.tsx` | إصلاح الضغط الطويل + ترجمة العناوين |
| `src/components/pos/ProductDetailsDialog.tsx` | تحسين التصميم + الترجمة |
| `src/components/pos/POSHeader.tsx` | إصلاح اتجاه الأزرار LTR/RTL |
| `src/components/layout/Sidebar.tsx` | تحسين انتقالات الإغلاق |
| `src/pages/CashShifts.tsx` | ترجمة النصوص العربية المباشرة |
| `src/pages/Products.tsx` | ترجمة "سعر الجملة" |
| `src/components/products/PurchaseInvoiceItemForm.tsx` | ترجمة "سعر الجملة" |
| `src/components/reports/ProfitTrendChart.tsx` | ترجمة النصوص |
