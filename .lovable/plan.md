
# خطة تحسين فاتورة الشراء + أوضاع عرض المنتجات في نقطة البيع

---

## 1. إعادة تصميم نموذج فاتورة الشراء (الخطوة 1 - البيانات الأساسية)

### المشاكل الحالية:
- عدد الأصناف وإجمالي الكميات وإجمالي التكلفة تظهر متلاصقة في `grid-cols-3`
- لا يوجد حقل "رقم الشركة" أو "رقم المورد"
- التصميم العام بسيط وغير احترافي

### الحل:
**الملف: `src/components/products/PurchaseInvoiceDialog.tsx`**

- تحويل القيم المتوقعة من `grid-cols-3` إلى أسطر منفصلة (`space-y-2`) كل سطر يحتوي على label + input بشكل واضح
- إضافة حقلين جديدين:
  - **رقم الشركة** (Company ID) - حقل نصي اختياري
  - **رقم المورد** (Supplier ID) - حقل نصي اختياري
- هذان الحقلان سيُحفظان ضمن حقل `notes` كـ JSON أو سيتم تخزينهما في `supplier_company` (بما أنه موجود بالفعل في الجدول)

**تحسينات بصرية:**
- كل حقل من القيم المتوقعة يظهر في سطر منفصل مع تسمية واضحة
- إضافة حدود وتباعد أفضل بين الأقسام
- تحسين مظهر مؤشر الخطوات

---

## 2. تحسين نموذج إضافة المنتج في فاتورة الشراء (الخطوة 2)

### المشاكل الحالية:
- رموز غير مفهومة (icons بدون نص واضح)
- حقول محدودة لا تتطابق مع نظام إضافة المنتج الخارجي
- لا يتم عرض الحقول المفعلة من الإعدادات (تاريخ صلاحية، رقم تسلسلي، ضمان، إلخ)

### الحل:
**الملف: `src/components/products/PurchaseInvoiceItemForm.tsx`**

- إزالة الرموز الصغيرة غير المفهومة من الـ Labels أو استبدالها بنصوص واضحة
- استيراد `getEffectiveFieldsConfig` من `product-fields-config.ts`
- إضافة الحقول الديناميكية حسب الإعدادات المفعلة:
  - تاريخ الصلاحية (إذا مفعل)
  - الرقم التسلسلي (إذا مفعل)
  - الضمان (إذا مفعل)
  - سعر الجملة (إذا مفعل)
  - المقاس واللون (إذا مفعل)
  - الحد الأدنى للمخزون (إذا مفعل)
- توحيد تصميم الحقول ليطابق نظام إضافة المنتج من الخارج
- تحسين تسميات الأزرار والحقول (بدلاً من `$ شراء` استخدام `سعر الشراء`)

---

## 3. أوضاع عرض المنتجات في نقطة البيع (POS)

### المشكلة الحالية:
- وضع عرض واحد فقط (بطاقات مع صور)
- لا يوجد خيار لتغيير طريقة العرض

### الحل:
**الملف: `src/components/pos/ProductGrid.tsx`**

إضافة 3 أوضاع عرض مع أزرار تبديل بجانب شريط البحث:

| الوضع | الوصف |
|-------|-------|
| **بطاقات (Grid)** | العرض الحالي - بطاقات مع صور (الافتراضي) |
| **أسطر (List)** | كل منتج في سطر أفقي واحد: صورة صغيرة + اسم + سعر + كمية |
| **بدون صور (Compact)** | أسطر نصية فقط: اسم المنتج + السعر + الكمية بدون أي صور |

**التنفيذ:**
- إضافة state `viewMode: 'grid' | 'list' | 'compact'`
- حفظ الوضع المختار في `localStorage` لتذكره
- إضافة 3 أزرار صغيرة بجانب زر الباركود:
  - أيقونة شبكة (LayoutGrid) للبطاقات
  - أيقونة قائمة (List) للأسطر
  - أيقونة نص (AlignJustify) لبدون صور
- تغيير CSS الشبكة حسب الوضع:
  - Grid: `grid-cols-2 sm:grid-cols-3` (الحالي)
  - List: `grid-cols-1` مع كل عنصر كسطر أفقي
  - Compact: `grid-cols-1` بدون صور

---

## ملخص الملفات المتأثرة

| الملف | التغيير |
|-------|---------|
| `src/components/products/PurchaseInvoiceDialog.tsx` | تصميم جديد للخطوة 1 + حقول رقم الشركة ورقم المورد + أسطر منفصلة للقيم المتوقعة |
| `src/components/products/PurchaseInvoiceItemForm.tsx` | إزالة الرموز غير المفهومة + إضافة حقول الإعدادات الديناميكية + توحيد مع نظام إضافة المنتج |
| `src/components/pos/ProductGrid.tsx` | إضافة 3 أوضاع عرض (بطاقات / أسطر / بدون صور) مع أزرار تبديل |
