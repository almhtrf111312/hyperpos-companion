

# إصلاح مشكلة وضع الفرن الذي يعرض واجهة المكتبة

## المشكلة الجذرية
عند تغيير نوع المتجر من القائمة المنسدلة في الإعدادات، يحدث التالي:
- حقول المنتجات (author, publisher, etc.) تتحدث فوراً في localStorage
- لكن نوع المتجر نفسه (الذي يتحكم في المصطلحات مثل "إضافة كتاب" vs "إضافة صنف") لا يُحفظ في localStorage إلا عند الضغط على زر الحفظ

هذا يعني أنه إذا كنت على وضع "مكتبة" وانتقلت لوضع "فرن":
- الحقول تتغير لحقول الفرن (صحيح)
- لكن المصطلحات تبقى مصطلحات المكتبة ("إضافة كتاب" بدل "إضافة صنف") لأن الإعدادات المحفوظة لا تزال "bookstore"

## الحل

### تعديل ملف واحد: `src/pages/Settings.tsx`

عند تغيير نوع المتجر من القائمة المنسدلة (onChange):
1. حفظ الإعدادات الكاملة في localStorage فوراً (وليس فقط حقول المنتجات)
2. هذا يضمن أن `getCurrentStoreType()` يقرأ القيمة الجديدة عندما يُطلق حدث `STORE_TYPE_CHANGED`

### التغيير التقني
في handler تغيير نوع المتجر (سطر 964-979)، إضافة حفظ فوري لـ `hyperpos_settings_v1` مع النوع الجديد:

```text
الحالي:
1. تحديث React state فقط
2. حفظ حقول المنتجات في localStorage
3. إطلاق حدث STORE_TYPE_CHANGED
4. getCurrentStoreType() يقرأ القيمة القديمة!

بعد الإصلاح:
1. تحديث React state
2. حفظ حقول المنتجات في localStorage
3. حفظ نوع المتجر الجديد في localStorage فوراً
4. إطلاق حدث STORE_TYPE_CHANGED
5. getCurrentStoreType() يقرأ القيمة الصحيحة
```

### النتيجة
- عند اختيار "فرن/مخبز" من القائمة: تظهر مصطلحات الفرن ("إضافة صنف"، "قائمة المبيعات") وليس مصطلحات المكتبة
- عند اختيار أي نوع آخر: المصطلحات تتغير فوراً وبشكل صحيح
- جميع أنواع المتاجر تعمل بشكل متسق

