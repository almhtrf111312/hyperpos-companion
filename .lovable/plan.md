

# إصلاح عدم تحديث المصطلحات والأصناف عند تغيير نوع المتجر

## المشكلة
عند تغيير نوع المتجر (مثلاً من صيدلية إلى بقالة أو ملابس):
1. تبقى كلمة "الأدوية" في الشريط الجانبي وعناوين الصفحات بدلاً من التحديث للمصطلح الصحيح (مثل "المنتجات" أو "الأصناف")
2. الأصناف في السحابة لا تتحدث عند تغيير النوع - فقط النسخة المحلية تتغير

## السبب الجذري
- `LanguageProvider` يقرأ `storeType` من localStorage مرة واحدة أثناء الرندر، لكن لا يوجد state يُحدّث واجهة المستخدم عند تغييره
- عند تغيير النوع في الإعدادات، يتم حفظ الأصناف محلياً فقط (`saveCategories`) بدون تحديث جدول الأصناف في السحابة

## التغييرات المطلوبة

### 1. جعل `storeType` متفاعل في `LanguageProvider`
**الملف:** `src/hooks/use-language.tsx`

- تحويل `storeType` من متغير عادي إلى `useState`
- إضافة مستمع لأحداث تغيير نوع المتجر عبر `storage` event أو حدث مخصص
- عند تغيير النوع، يتم تحديث الـ state مما يؤدي لإعادة رندر كل المكونات التي تستخدم `tDynamic`

### 2. إضافة حدث تغيير نوع المتجر
**الملف:** `src/lib/events.ts`

- إضافة حدث `STORE_TYPE_CHANGED` إلى قائمة الأحداث

### 3. إطلاق الحدث عند تغيير النوع في الإعدادات
**الملف:** `src/pages/Settings.tsx`

- عند تغيير نوع المتجر وحفظ الإعدادات، إطلاق حدث `STORE_TYPE_CHANGED`

### 4. مزامنة الأصناف مع السحابة عند تغيير النوع
**الملف:** `src/pages/Settings.tsx`

- عند اختيار "استبدال الأصناف"، بدلاً من `saveCategories()` المحلي فقط:
  - حذف الأصناف القديمة من السحابة
  - إضافة الأصناف الجديدة للسحابة
  - إبطال الـ cache

### 5. تحديث الأصناف الافتراضية في السحابة
**الملف:** `src/lib/cloud/categories-cloud.ts`

- تغيير الأصناف الافتراضية المثبتة (هواتف، أكسسوارات...) لتستخدم `getDefaultCategories()` بناءً على نوع المتجر الحالي

## النتيجة
- عند تغيير نوع المتجر، جميع المصطلحات في الشريط الجانبي والعناوين تتحدث فوراً
- الأصناف تتزامن مع السحابة بشكل صحيح
