

# خطة تحسين لوحة التحكم + الإشعارات + نظام الأرشيف

## نظرة عامة
هذه الخطة تتضمن 4 محاور رئيسية لتحسين تجربة المستخدم على الهاتف المحمول وإضافة نظام أرشيف متكامل.

---

## 1. إعادة تصميم لوحة التحكم على الموبايل (Dashboard.tsx)

### المشكلة الحالية
- بطاقات الإحصائيات تعرض كسطر واحد (`grid-cols-1`) على الموبايل بدلاً من بطاقات متعددة
- لا يوجد فصل بصري بين أقسام الداشبورد
- البطاقات المخصصة (مبيعات الأسبوع، الشهر، قيمة المخزون...) لا تحتوي على روابط للتنقل

### الحل
**تغيير التخطيط:**
- تحويل جميع أقسام الإحصائيات من `grid-cols-1 md:grid-cols-3` إلى `grid-cols-2 md:grid-cols-3`
- كل بطاقة تصبح قابلة للنقر وتنقل المستخدم للصفحة المناسبة

**إضافة فواصل بين الأقسام:**
- بعد "الإجراءات السريعة" يظهر فاصل مكتوب عليه "المبيعات"
- بعد المبيعات يظهر فاصل "الأداء المالي"
- بعد الأداء المالي يظهر فاصل "تقارير رأس المال" (يضم: قيمة المخزون، رأس المال الإجمالي، رصيد الصندوق، رأس المال السائل)
- في الأسفل فاصل "آخر الفواتير"

**تحويل البطاقات المخصصة إلى StatCard:**
- استبدال الـ divs المخصصة لمبيعات الأسبوع/الشهر/المخزون/رأس المال/الصندوق/رأس المال السائل بمكوّن `StatCard` الموجود مسبقاً
- إضافة `linkTo` لكل بطاقة لتكون قابلة للنقر

**الملف المتأثر:** `src/pages/Dashboard.tsx`

---

## 2. إصلاح عرض الفواتير الأخيرة (RecentInvoices.tsx)

### المشكلة الحالية
- الفواتير تعرض كجدول (table) على الموبايل مما يسبب تكسّر النص
- رقم الفاتورة يظهر على سطرين
- اسم العميل يتكسر على سطرين

### الحل
- على الموبايل: تحويل العرض من جدول إلى بطاقات مضغوطة (compact cards)
- كل فاتورة تعرض كسطر أفقي واحد يحتوي: رقم مختصر + اسم العميل + المبلغ + الحالة (badge لوني)
- فصل الفواتير بخطوط خفيفة وألوان خلفية متناوبة (striped)
- الحفاظ على عرض الجدول للشاشات الكبيرة

**الملف المتأثر:** `src/components/dashboard/RecentInvoices.tsx`

---

## 3. تحسين نظام الإشعارات (NotificationBell.tsx + use-notifications.tsx)

### المشكلة الحالية
- لا يوجد زر "إخفاء" واضح لكل إشعار (الزر الحالي يظهر عند hover فقط)
- الإشعارات المخفية تختفي نهائياً بدون أرشيف

### الحل
**في NotificationBell.tsx:**
- إضافة زر "إخفاء" (Archive) ظاهر دائماً لكل إشعار (ليس فقط عند hover)
- عند النقر على "إخفاء"، يتم نقل الإشعار إلى أرشيف الإشعارات بدلاً من حذفه

**في use-notifications.tsx:**
- إضافة state جديد `archivedNotifications` مع حفظه في `localStorage`
- إضافة دالة `archiveNotification(id)` تنقل الإشعار من القائمة النشطة للأرشيف
- إضافة دالة `getArchivedNotifications()` لاسترجاع الأرشيف

**الملفات المتأثرة:**
- `src/hooks/use-notifications.tsx`
- `src/components/layout/NotificationBell.tsx`

---

## 4. نظام الأرشيف في الإعدادات (Settings.tsx + مكوّن جديد)

### الفكرة
إضافة تبويب "الأرشيف" في صفحة الإعدادات يحتوي على:

**4.1 أرشيف الإشعارات:**
- عرض جميع الإشعارات التي تم إخفاؤها
- إمكانية حذفها نهائياً أو إعادتها

**4.2 الأرشيف العام (البيانات المؤرشفة):**
- **الديون المدفوعة بالكامل:** ديون بحالة `fully_paid` تظهر هنا مع إمكانية إعادة فتحها (إضافة دين جديد عليها)
- **المنتجات منتهية المخزون:** منتجات بكمية 0 تظهر هنا مع إمكانية تعديل الكمية وإعادتها
- **الفواتير المسترجعة:** فواتير بحالة `cancelled` تظهر كأرشيف تدقيق

عند تعديل عنصر مؤرشف (مثلاً إضافة كمية لمنتج أو إعادة فتح دين)، يعود تلقائياً للقائمة الأصلية.

### الملفات الجديدة والمتأثرة

| الملف | النوع | الوصف |
|-------|-------|-------|
| `src/components/settings/ArchiveSection.tsx` | جديد | مكوّن الأرشيف الرئيسي بتبويبين (إشعارات + عام) |
| `src/pages/Settings.tsx` | تعديل | إضافة تبويب "الأرشيف" في قائمة التبويبات |
| `src/hooks/use-notifications.tsx` | تعديل | إضافة أرشيف الإشعارات |
| `src/components/layout/NotificationBell.tsx` | تعديل | إضافة زر إخفاء ظاهر |

---

## 5. مكوّن فاصل الأقسام (جديد)

مكوّن بسيط `SectionDivider` يعرض خط أفقي رفيع مع عنوان القسم في المنتصف:

```text
──────── تقارير رأس المال ────────
```

**الملف الجديد:** `src/components/dashboard/SectionDivider.tsx`

---

## ملخص الملفات

| الملف | التغيير |
|-------|---------|
| `src/pages/Dashboard.tsx` | تخطيط 2x على الموبايل + فواصل أقسام + بطاقات قابلة للنقر |
| `src/components/dashboard/RecentInvoices.tsx` | عرض بطاقات مضغوطة على الموبايل بدل الجدول |
| `src/components/dashboard/SectionDivider.tsx` | مكوّن جديد لفواصل الأقسام |
| `src/hooks/use-notifications.tsx` | أرشيف إشعارات + دوال أرشفة |
| `src/components/layout/NotificationBell.tsx` | زر إخفاء ظاهر + نقل للأرشيف |
| `src/components/settings/ArchiveSection.tsx` | مكوّن أرشيف جديد (إشعارات + عام) |
| `src/pages/Settings.tsx` | إضافة تبويب الأرشيف |

